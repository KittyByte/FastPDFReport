<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FastAPI Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --main-color: #009688;
    }

    body {
      background-color: #f8f9fa;
    }

    .card {
      border-radius: 16px;
    }

    .logo-circle {
      background-color: var(--main-color);
      background-image: linear-gradient(145deg, #00a89b, #00897b);
      color: white;
    }

    .text-main {
      color: var(--main-color) !important;
    }

    .btn-main {
      background-color: var(--main-color);
      border-color: var(--main-color);
      color: white;
    }

    .btn-main:hover {
      background-color: #00897b;
      border-color: #00796b;
      color: white;
    }

    .btn-eye {
      font-size: 18px;
      line-height: 1;
      color: #6c757d;
    }

    .btn-eye:hover {
      color: var(--main-color);
    }

    a {
      color: var(--main-color);
    }

    a:hover {
      color: #00796b;
    }
  </style>
</head>

<body class="d-flex align-items-center justify-content-center vh-100">
  <div class="card shadow-sm p-4" style="width: 380px;">
    <div class="text-center mb-4">
      <div class="d-inline-flex align-items-center justify-content-center logo-circle rounded-circle mb-2"
        style="width:60px; height:60px; font-size:28px;">
        ‚ö°
      </div>
      <h3 class="fw-bold text-main">FastAPI</h3>
    </div>

    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
        <input type="text" class="form-control" id="username" name="username" required>
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
        <div class="position-relative">
          <input type="password" class="form-control pe-5" id="password" name="password" required>
          <button type="button"
            class="btn btn-sm position-absolute top-50 end-0 translate-middle-y me-2 p-0 border-0 btn-eye"
            id="togglePwd" tabindex="-1">
            üëÅÔ∏è
          </button>
        </div>
      </div>

      <div class="d-grid mb-2">
        <button type="submit" class="btn btn-main">–í–æ–π—Ç–∏</button>
      </div>

      <div class="text-center">
        <a href="#" class="small text-decoration-none">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
      </div>

      <div id="message" class="text-center mt-3 small"></div>
    </form>
  </div>

  <script>
    const TOKEN_URL = 'http://127.0.0.1/users/token';
    const form = document.getElementById('loginForm');
    const message = document.getElementById('message');
    const togglePwd = document.getElementById('togglePwd');
    const passwordInput = document.getElementById('password');

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    togglePwd.addEventListener('click', () => {
      passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–Ω–∞
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      message.textContent = '';
      message.className = 'text-center mt-3 small';

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !password) {
        message.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å.';
        message.classList.add('text-danger');
        return;
      }

      try {
        // –°–æ–∑–¥–∞—ë–º form-data
        const formData = new URLSearchParams();
        formData.append('username', username);
        formData.append('password', password);

        const res = await fetch(TOKEN_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: formData.toString()
        });

        const data = await res.json();

        if (!res.ok) {
          message.textContent = data.detail || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.';
          message.classList.add('text-danger');
          return;
        }

        const token = data.access_token;
        if (!token) {
          message.textContent = '–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω.';
          message.classList.add('text-danger');
          return;
        }

        localStorage.setItem('access_token', token);
        message.textContent = '–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
        message.classList.add('text-success');

        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        setTimeout(() => {
          window.location.href = 'http://127.0.0.1/reports/reports';
        }, 1000); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
      } catch (err) {
        console.error(err);
        message.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
        message.classList.add('text-danger');
      }
    });
  </script>

</body>

</html>